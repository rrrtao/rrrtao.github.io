<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>比特笔</title>
  
  <subtitle>个人笔记</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://btbib.com/"/>
  <updated>2020-06-17T04:51:43.160Z</updated>
  <id>http://btbib.com/</id>
  
  <author>
    <name>比特笔</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>VMware搭建最新k8s集群v1.18.3</title>
    <link href="http://btbib.com/2020-06-17-1.html"/>
    <id>http://btbib.com/2020-06-17-1.html</id>
    <published>2020-06-17T04:37:39.000Z</published>
    <updated>2020-06-17T04:51:43.160Z</updated>
    
    <content type="html"><![CDATA[<h3 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h3><table><thead><tr><th>环境</th><th align="right">说明</th></tr></thead><tbody><tr><td>宿主机</td><td align="right">win10（16G）</td></tr><tr><td>VMware</td><td align="right">15.5.1</td></tr><tr><td>centOS 7</td><td align="right"><a href="http://mirrors.aliyun.com/centos/7/isos/x86_64/CentOS-7-x86_64-DVD-2003.iso" target="_blank" rel="noopener">下载地址</a></td></tr></tbody></table><h3 id="虚拟机"><a href="#虚拟机" class="headerlink" title="虚拟机"></a>虚拟机</h3><table><thead><tr><th>环境</th><th align="right">说明</th></tr></thead><tbody><tr><td>10.0.0.128</td><td align="right">master-k8s 4C4G</td></tr><tr><td>10.0.0.129</td><td align="right">node2-k8s 4C4G</td></tr><tr><td>10.0.0.130</td><td align="right">node3-k8s 4C4G</td></tr></tbody></table><blockquote><p>先在 master-k8s 上安装基本软件服务，然后在克隆node2-k8s,node3-k8s</p></blockquote><hr><p><strong>* 3台centos都要执行的步骤  [start] *</strong></p><h4 id="关闭防火墙"><a href="#关闭防火墙" class="headerlink" title="关闭防火墙"></a>关闭防火墙</h4><p>顺序执行命令：</p><ul><li>iptables -F</li><li>setenforce 0</li><li>systemctl stop firewalld</li><li>systemctl disable firewalld</li></ul><h4 id="修改hostname"><a href="#修改hostname" class="headerlink" title="修改hostname"></a>修改hostname</h4><p>执行命令： vi /etc/hostname<br>10.0.0.128 改成 master-k8s<br>10.0.0.129 改成 node2-k8s<br>10.0.0.130 改成 node3-k8s</p><h4 id="修改host文件"><a href="#修改host文件" class="headerlink" title="修改host文件"></a>修改host文件</h4><p>vi /etc/hosts</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line">10.0.0.128  master-k8s</span><br><span class="line">10.0.0.129  node2-k8s</span><br><span class="line">10.0.0.130  node3-k8s</span><br></pre></td></tr></table></figure><h4 id="禁用swap"><a href="#禁用swap" class="headerlink" title="禁用swap"></a>禁用swap</h4><p>执行命令：</p><ul><li>swapoff -a</li><li>vi /etc/fstab</li></ul><p>找到下面行在前面加一个 # 注释 swap功能</p><p><code>#/dev/mapper/centos-swap swap swap    defaults        0 0    #禁用swap自动挂载</code></p><h4 id="安装Docker"><a href="#安装Docker" class="headerlink" title="安装Docker"></a>安装Docker</h4><p>顺序执行命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y yum-utils device-mapper-persistent-data lvm2</span><br><span class="line">sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class="line">sudo yum install docker-ce-18.09.1 docker-ce-cli-18.09.1 containerd.io</span><br><span class="line">systemctl start docker.service</span><br><span class="line">systemctl enable docker.service</span><br></pre></td></tr></table></figure><p>配置阿里云镜像加速器</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">cat&gt;</span><span class="bash">&gt;/etc/docker/daemon.json&lt;&lt;EOF</span></span><br><span class="line">&#123;</span><br><span class="line">        "registry-mirrors":[ "https://x6stvqqp.mirror.aliyuncs.com" ]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><p>上面执行完后 重启docker生效</p><p>执行命令：</p><ul><li>systemctl daemon-reload</li><li>systemctl restart docker</li></ul><p>添加K8s国内镜像源</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cat&gt;&gt;&#x2F;etc&#x2F;yum.repos.d&#x2F;kubrenetes.repo&lt;&lt;EOF</span><br><span class="line">[kubernetes]</span><br><span class="line">name&#x3D;Kubernetes Repo</span><br><span class="line">baseurl&#x3D;https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;kubernetes&#x2F;yum&#x2F;repos&#x2F;kubernetes-el7-x86_64&#x2F;</span><br><span class="line">gpgcheck&#x3D;0</span><br><span class="line">gpgkey&#x3D;https:&#x2F;&#x2F;mirrors.aliyun.com&#x2F;kubernetes&#x2F;yum&#x2F;doc&#x2F;yum-key.gpg</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h4 id="安装K8s所需要的3个组件"><a href="#安装K8s所需要的3个组件" class="headerlink" title="安装K8s所需要的3个组件"></a>安装K8s所需要的3个组件</h4><p>执行命令：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y kubeadm-1.18.3  kubelet-1.18.3  kubectl-1.18.3</span><br></pre></td></tr></table></figure><p>说明：</p><ul><li><p>kubeadm：安装工具，使所有的组件都会以容器的方式运行</p></li><li><p>kubectl：客户端连接K8S API工具</p></li><li><p>kubelet：运行在node节点，用来启动容器的工具</p></li></ul><h4 id="设置k8s开机自启动"><a href="#设置k8s开机自启动" class="headerlink" title="设置k8s开机自启动"></a>设置k8s开机自启动</h4><p>执行命令：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable kubelet.service</span><br></pre></td></tr></table></figure><p>加载内核模块</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cat&gt;&gt;&#x2F;etc&#x2F;sysctl.d&#x2F;k8s.conf &lt;&lt; EOF</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables &#x3D; 1</span><br><span class="line">net.bridge.bridge-nf-call-iptables &#x3D; 1</span><br><span class="line">net.ipv4.ip_nonlocal_bind &#x3D; 1</span><br><span class="line">net.ipv4.ip_forward &#x3D; 1</span><br><span class="line">vm.swappiness&#x3D;0</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><p>然后执行</p><ul><li>vi /etc/sysctl.conf 填写： net.ipv4.ip_forward = 1</li><li>执行命令： sysctl -p</li></ul><p>执行命令：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; &#x2F;etc&#x2F;sysconfig&#x2F;modules&#x2F;ipvs.modules &lt;&lt;EOF</span><br><span class="line">#!&#x2F;bin&#x2F;bash</span><br><span class="line">modprobe -- br_netfilter</span><br><span class="line">modprobe -- ip_vs</span><br><span class="line">modprobe -- ip_vs_rr</span><br><span class="line">modprobe -- ip_vs_wrr</span><br><span class="line">modprobe -- ip_vs_sh</span><br><span class="line">modprobe -- nf_conntrack_ipv4</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><p>执行命令：</p><ul><li>chmod 755 /etc/sysconfig/modules/ipvs.modules</li><li>bash /etc/sysconfig/modules/ipvs.modules</li><li>lsmod | grep -E “ip_vs|nf_conntrack_ipv4”</li></ul><p><strong>* 上面的步骤需要在3台centos虚拟机都得执行的！[end] *</strong> </p><p>建议：现在master-k8s上完成配置，然后克隆，修改hostname</p><hr><h2 id="下面的步骤只在master-k8s-机器上操作"><a href="#下面的步骤只在master-k8s-机器上操作" class="headerlink" title="下面的步骤只在master-k8s 机器上操作"></a>下面的步骤只在master-k8s 机器上操作</h2><p>通过如下指令创建默认的kubeadm-config.yaml文件：</p><p>执行命令：</p><ul><li>kubeadm config print init-defaults &gt; kubeadm-config.yaml</li></ul><p>然后修改 kubeadm-config.yaml配置</p><p>下面有注释的地方就是要修改的地方！</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">[root@master-k8s ~]# vi kubeadm-config.yaml</span><br><span class="line">apiVersion: kubeadm.k8s.io&#x2F;v1beta2</span><br><span class="line">bootstrapTokens:</span><br><span class="line">- groups:</span><br><span class="line">  - system:bootstrappers:kubeadm:default-node-token</span><br><span class="line">  token: abcdef.0123456789abcdef</span><br><span class="line">  ttl: 24h0m0s</span><br><span class="line">  usages:</span><br><span class="line">  - signing</span><br><span class="line">  - authentication</span><br><span class="line">kind: InitConfiguration</span><br><span class="line">localAPIEndpoint:</span><br><span class="line">  advertiseAddress: 10.0.0.128  #master节点的IP</span><br><span class="line">  bindPort: 6443</span><br><span class="line">nodeRegistration:</span><br><span class="line">  criSocket: &#x2F;var&#x2F;run&#x2F;dockershim.sock</span><br><span class="line">  name: 10.0.0.128                       #修改为IP地址，如果使用域名，必须保证解析正常</span><br><span class="line">  taints:</span><br><span class="line">  - effect: NoSchedule</span><br><span class="line">    key: node-role.kubernetes.io&#x2F;master</span><br><span class="line">---</span><br><span class="line">apiServer:</span><br><span class="line">  timeoutForControlPlane: 4m0s</span><br><span class="line">apiVersion: kubeadm.k8s.io&#x2F;v1beta2</span><br><span class="line">certificatesDir: &#x2F;etc&#x2F;kubernetes&#x2F;pki</span><br><span class="line">clusterName: kubernetes</span><br><span class="line">controllerManager: &#123;&#125;</span><br><span class="line">dns:</span><br><span class="line">  type: CoreDNS</span><br><span class="line">etcd:</span><br><span class="line">  local:</span><br><span class="line">    dataDir: &#x2F;var&#x2F;lib&#x2F;etcd                       #把etcd容器的目录挂载到本地的&#x2F;var&#x2F;lib&#x2F;etcd目录下，防止数据丢失</span><br><span class="line">imageRepository: registry.cn-hangzhou.aliyuncs.com&#x2F;google_containers          #镜像仓库地址</span><br><span class="line">kind: ClusterConfiguration</span><br><span class="line">kubernetesVersion: v1.18.3                     #Kubernetes软件版本</span><br><span class="line">networking:</span><br><span class="line">  dnsDomain: cluster.local</span><br><span class="line">  serviceSubnet: 10.96.0.0&#x2F;12</span><br><span class="line">  podSubnet: 10.244.0.0&#x2F;16        #添加这个内容</span><br><span class="line">scheduler: &#123;&#125;</span><br></pre></td></tr></table></figure><h4 id="预先下载镜像"><a href="#预先下载镜像" class="headerlink" title="预先下载镜像"></a>预先下载镜像</h4><p>执行命令：</p><ul><li>kubeadm config images pull –config kubeadm-config.yaml</li></ul><p>执行命令：</p><ul><li>echo ‘1’ &gt; /proc/sys/net/bridge/bridge-nf-call-iptables</li></ul><h4 id="安装matser节点"><a href="#安装matser节点" class="headerlink" title="安装matser节点"></a>安装matser节点</h4><p>执行命令：</p><ul><li>kubeadm init –config kubeadm-config.yaml</li></ul><p>如果输出以下信息表示，swap没有被禁用</p><ul><li>[ERROR Swap]: running with swap on is not supported. Please disable swap</li><li>输出以下信息表示，请执行echo ‘1’ &gt; /proc/sys/net/bridge/bridge-nf-call-iptables</li></ul><p>[ERROR FileContent–proc-sys-net-bridge-bridge-nf-call-iptables]: /proc/sys/net/bridge/bridge-nf-call-iptables contents are not set to 1</p><p>安装成功后注意看console上运行的信息</p><p>执行命令：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p $HOME&#x2F;.kube</span><br><span class="line">sudo cp -i &#x2F;etc&#x2F;kubernetes&#x2F;admin.conf $HOME&#x2F;.kube&#x2F;config</span><br><span class="line">sudo chown $(id -u):$(id -g) $HOME&#x2F;.kube&#x2F;config</span><br></pre></td></tr></table></figure><h4 id="在master-k8s获取token、cert-hash"><a href="#在master-k8s获取token、cert-hash" class="headerlink" title="在master-k8s获取token、cert-hash"></a>在master-k8s获取token、cert-hash</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@master-k8s]# kubeadm  token create</span><br><span class="line">kiyfhw.xiacqbch8o8fa8qj</span><br><span class="line"></span><br><span class="line">[root@master-k8s]# kubeadm  token list</span><br><span class="line">TOKEN                     TTL         EXPIRES                     USAGES                   DESCRIPTION   EXTRA GROUPS</span><br><span class="line">abcdef.0123456789abcdef   &lt;invalid&gt;   2020-06-10T14:16:06+08:00   authentication,signing   &lt;none&gt;        system:bootstrappers:kubeadm:default-node-token</span><br><span class="line">kiyfhw.xiacqbch8o8fa8qj   23h         2020-06-10T06:39:24+08:00   authentication,signing   &lt;none&gt;        system:bootstrappers:kubeadm:default-node-token</span><br><span class="line"></span><br><span class="line"># 生成ca的sha256 hash值</span><br><span class="line">[root@master-k8s]# openssl x509 -pubkey -in &#x2F;etc&#x2F;kubernetes&#x2F;pki&#x2F;ca.crt | openssl rsa -pubin -outform der 2&gt;&#x2F;dev&#x2F;null | openssl dgst -sha256 -hex | sed &#39;s&#x2F;^.* &#x2F;&#x2F;&#39;</span><br><span class="line">5417eb1b68bd4e7a4c82aded83abc55ec91bd601e45734d6aba85de8b1ebb057</span><br></pre></td></tr></table></figure><h4 id="kubeadm-join"><a href="#kubeadm-join" class="headerlink" title="kubeadm join"></a>kubeadm join</h4><p>把下面的命令拿到 10.0.0.129/10.0.0.130 工作节点虚拟机上运行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubeadm join 10.0.0.128:6443 --token kiyfhw.xiacqbch8o8fa8qj   --discovery-token-ca-cert-hash sha256:5417eb1b68bd4e7a4c82aded83abc55ec91bd601e45734d6aba85de8b1ebb057</span><br></pre></td></tr></table></figure><p>若果有失败提示<br>在node节点上配置信息</p><ul><li>vi /etc/docker/daemon.json</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">        <span class="attr">"registry-mirrors"</span>:[ <span class="string">"https://x6stvqqp.mirror.aliyuncs.com"</span> ],</span><br><span class="line"><span class="attr">"exec-opts"</span>:[<span class="string">"native.cgroupdriver=systemmd"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>以上运行成功 检测下</p><p>在master-k8s执行命令</p><ul><li>sudo kubectl get nodes</li></ul><p>你会发现 Status 是 NotReady，因为没有安装网络插件！</p><h4 id="安装网络插件flannel"><a href="#安装网络插件flannel" class="headerlink" title="安装网络插件flannel"></a>安装网络插件flannel</h4><p>因为上面我们安装的的k8s的版本是 v 1.18.3</p><p>这个版本对应的 flannel 版本是：v0.12.0</p><p>因为由于某种不可抗力 一定得先下载好docker镜像！</p><ul><li>docker pull quay-mirror.qiniu.com/coreos/flannel:v0.12.0-amd64</li></ul><p>下载 flannel 的 yml文件：</p><ul><li>wget <a href="https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml" target="_blank" rel="noopener">https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</a></li></ul><p>执行命令：</p><ul><li>kubectl apply -f kube-flannel.yml</li></ul><p>等待k8s 把 pod：flannel生效 可以用命令查看状态进度：</p><ul><li>kubectl get pods -n kube-system</li></ul><p>等 flannel 状态显示 Running后</p><p>执行查看k8s集群运行状态命令：</p><ul><li>kubectl get nodes</li></ul><table><thead><tr><th>NAME</th><th>STATUS</th><th>ROLES</th><th>AGE</th><th>VERSION</th></tr></thead><tbody><tr><td>10.0.0.128</td><td>Ready</td><td>master</td><td>30m</td><td>v1.18.3</td></tr><tr><td>node2-k8s</td><td>NotReady</td><td><none></td><td>50m</td><td>v1.18.3</td></tr><tr><td>node3-k8s</td><td>NotReady</td><td><none></td><td>51m</td><td>v1.18.3</td></tr></tbody></table><p>发现master已经Ready了 但是工作node没有起来，状态是NotReady</p><p>下面去配置工作node虚拟机上的flannel配置</p><p>10.0.0.129 是我的工作node2-k8s</p><h4 id="运行命令把master节点的配置copy到工作节点"><a href="#运行命令把master节点的配置copy到工作节点" class="headerlink" title="运行命令把master节点的配置copy到工作节点"></a>运行命令把master节点的配置copy到工作节点</h4><ul><li>scp -r 10.0.0.128:/etc/cni /etc/cni</li></ul><p>重启启动 kubelet</p><ul><li>systemctl restart kubelet</li></ul><p>回到master节点查看</p><p>执行查看k8s集群运行状态命令：</p><ul><li>kubectl get nodes</li></ul><table><thead><tr><th>NAME</th><th>STATUS</th><th>ROLES</th><th>AGE</th><th>VERSION</th></tr></thead><tbody><tr><td>10.0.0.128</td><td>Ready</td><td>master</td><td>30m</td><td>v1.18.3</td></tr><tr><td>node2-k8s</td><td>Ready</td><td><none></td><td>55m</td><td>v1.18.3</td></tr><tr><td>node3-k8s</td><td>Ready</td><td><none></td><td>56m</td><td>v1.18.3</td></tr></tbody></table><ul><li>kubectl get pods -n kube-system</li></ul><p>发现 有两个flannel 容器没有起来，那么在node2-k8s，node3-k8s检查是否有如下信息,没有就添加。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;run&#x2F;flannel&#x2F;subnet.env</span><br><span class="line">FLANNEL_NETWORK&#x3D;10.244.0.0&#x2F;16</span><br><span class="line">FLANNEL_SUBNET&#x3D;10.244.1.1&#x2F;24</span><br><span class="line">FLANNEL_MTU&#x3D;1450</span><br><span class="line">FLANNEL_IPMASQ&#x3D;true</span><br></pre></td></tr></table></figure><h2 id="安装Dashboard-UI-v2-0-1"><a href="#安装Dashboard-UI-v2-0-1" class="headerlink" title="安装Dashboard UI v2.0.1"></a>安装Dashboard UI v2.0.1</h2><p>参考地址：</p><p>部署文件 Github 地址：<a href="https://github.com/my-dlq/blog-example/tree/master/kubernetes/kubernetes-dashboard2.0.0-deploy" target="_blank" rel="noopener">https://github.com/my-dlq/blog-example/tree/master/kubernetes/kubernetes-dashboard2.0.0-deploy</a></p><p>###1、Dashboard RBAC</p><p>创建 Dashboard RBAC 部署文件</p><p>k8s-dashboard-rbac.yaml</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">apiVersion:</span> v1</span><br><span class="line"><span class="string">kind:</span> ServiceAccount</span><br><span class="line"><span class="string">metadata:</span></span><br><span class="line"><span class="symbol">  labels:</span></span><br><span class="line">    k8s-<span class="string">app:</span> kubernetes-dashboard</span><br><span class="line"><span class="symbol">  name:</span> kubernetes-dashboard</span><br><span class="line"><span class="symbol">  namespace:</span> kube-system</span><br><span class="line">---</span><br><span class="line"><span class="string">apiVersion:</span> rbac.authorization.k8s.io/v1</span><br><span class="line"><span class="string">kind:</span> Role</span><br><span class="line"><span class="string">metadata:</span></span><br><span class="line"><span class="symbol">  labels:</span></span><br><span class="line">    k8s-<span class="string">app:</span> kubernetes-dashboard</span><br><span class="line"><span class="symbol">  name:</span> kubernetes-dashboard</span><br><span class="line"><span class="symbol">  namespace:</span> kube-system</span><br><span class="line"><span class="string">rules:</span></span><br><span class="line">  - <span class="string">apiGroups:</span> [<span class="string">""</span>]</span><br><span class="line"><span class="symbol">    resources:</span> [<span class="string">"secrets"</span>]</span><br><span class="line"><span class="symbol">    resourceNames:</span> [<span class="string">"kubernetes-dashboard-key-holder"</span>, <span class="string">"kubernetes-dashboard-certs"</span>, <span class="string">"kubernetes-dashboard-csrf"</span>]</span><br><span class="line"><span class="symbol">    verbs:</span> [<span class="string">"get"</span>, <span class="string">"update"</span>, <span class="string">"delete"</span>]</span><br><span class="line">  - <span class="string">apiGroups:</span> [<span class="string">""</span>]</span><br><span class="line"><span class="symbol">    resources:</span> [<span class="string">"configmaps"</span>]</span><br><span class="line"><span class="symbol">    resourceNames:</span> [<span class="string">"kubernetes-dashboard-settings"</span>]</span><br><span class="line"><span class="symbol">    verbs:</span> [<span class="string">"get"</span>, <span class="string">"update"</span>]</span><br><span class="line">  - <span class="string">apiGroups:</span> [<span class="string">""</span>]</span><br><span class="line"><span class="symbol">    resources:</span> [<span class="string">"services"</span>]</span><br><span class="line"><span class="symbol">    resourceNames:</span> [<span class="string">"heapster"</span>, <span class="string">"dashboard-metrics-scraper"</span>]</span><br><span class="line"><span class="symbol">    verbs:</span> [<span class="string">"proxy"</span>]</span><br><span class="line">  - <span class="string">apiGroups:</span> [<span class="string">""</span>]</span><br><span class="line"><span class="symbol">    resources:</span> [<span class="string">"services/proxy"</span>]</span><br><span class="line"><span class="symbol">    resourceNames:</span> [<span class="string">"heapster"</span>, <span class="string">"http:heapster:"</span>, <span class="string">"https:heapster:"</span>, <span class="string">"dashboard-metrics-scraper"</span>, <span class="string">"http:dashboard-metrics-scraper"</span>]</span><br><span class="line"><span class="symbol">    verbs:</span> [<span class="string">"get"</span>]</span><br><span class="line">---</span><br><span class="line"><span class="string">apiVersion:</span> rbac.authorization.k8s.io/v1</span><br><span class="line"><span class="string">kind:</span> ClusterRole</span><br><span class="line"><span class="string">metadata:</span></span><br><span class="line"><span class="symbol">  labels:</span></span><br><span class="line">    k8s-<span class="string">app:</span> kubernetes-dashboard</span><br><span class="line"><span class="symbol">  name:</span> kubernetes-dashboard</span><br><span class="line"><span class="string">rules:</span></span><br><span class="line">  - <span class="string">apiGroups:</span> [<span class="string">"metrics.k8s.io"</span>]</span><br><span class="line"><span class="symbol">    resources:</span> [<span class="string">"pods"</span>, <span class="string">"nodes"</span>]</span><br><span class="line"><span class="symbol">    verbs:</span> [<span class="string">"get"</span>, <span class="string">"list"</span>, <span class="string">"watch"</span>]</span><br><span class="line">---</span><br><span class="line"><span class="string">apiVersion:</span> rbac.authorization.k8s.io/v1</span><br><span class="line"><span class="string">kind:</span> RoleBinding</span><br><span class="line"><span class="string">metadata:</span></span><br><span class="line"><span class="symbol">  labels:</span></span><br><span class="line">    k8s-<span class="string">app:</span> kubernetes-dashboard</span><br><span class="line"><span class="symbol">  name:</span> kubernetes-dashboard</span><br><span class="line"><span class="symbol">  namespace:</span> kube-system</span><br><span class="line"><span class="string">roleRef:</span></span><br><span class="line"><span class="symbol">  apiGroup:</span> rbac.authorization.k8s.io</span><br><span class="line"><span class="symbol">  kind:</span> Role</span><br><span class="line"><span class="symbol">  name:</span> kubernetes-dashboard</span><br><span class="line"><span class="string">subjects:</span></span><br><span class="line">  - <span class="string">kind:</span> ServiceAccount</span><br><span class="line"><span class="symbol">    name:</span> kubernetes-dashboard</span><br><span class="line"><span class="symbol">    namespace:</span> kube-system</span><br><span class="line">---</span><br><span class="line"><span class="string">apiVersion:</span> rbac.authorization.k8s.io/v1</span><br><span class="line"><span class="string">kind:</span> ClusterRoleBinding</span><br><span class="line"><span class="string">metadata:</span></span><br><span class="line"><span class="symbol">  name:</span> kubernetes-dashboard</span><br><span class="line"><span class="symbol">  namespace:</span> kube-system</span><br><span class="line"><span class="string">roleRef:</span></span><br><span class="line"><span class="symbol">  apiGroup:</span> rbac.authorization.k8s.io</span><br><span class="line"><span class="symbol">  kind:</span> ClusterRole</span><br><span class="line"><span class="symbol">  name:</span> kubernetes-dashboard</span><br><span class="line"><span class="string">subjects:</span></span><br><span class="line">  - <span class="string">kind:</span> ServiceAccount</span><br><span class="line"><span class="symbol">    name:</span> kubernetes-dashboard</span><br><span class="line"><span class="symbol">    namespace:</span> kube-system</span><br></pre></td></tr></table></figure><p>部署 Dashboard RBAC</p><ul><li>kubectl apply -f k8s-dashboard-rbac.yaml</li></ul><h3 id="创建-ConfigMap、Secret"><a href="#创建-ConfigMap、Secret" class="headerlink" title="创建 ConfigMap、Secret"></a>创建 ConfigMap、Secret</h3><p>创建 Dashboard Config &amp; Secret 部署文件</p><p>k8s-dashboard-configmap-secret.yaml</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">apiVersion:</span> v1</span><br><span class="line"><span class="string">kind:</span> Secret</span><br><span class="line"><span class="string">metadata:</span></span><br><span class="line"><span class="symbol">  labels:</span></span><br><span class="line">    k8s-<span class="string">app:</span> kubernetes-dashboard</span><br><span class="line"><span class="symbol">  name:</span> kubernetes-dashboard-certs</span><br><span class="line"><span class="symbol">  namespace:</span> kube-system</span><br><span class="line"><span class="string">type:</span> Opaque</span><br><span class="line">---</span><br><span class="line"><span class="string">apiVersion:</span> v1</span><br><span class="line"><span class="string">kind:</span> Secret</span><br><span class="line"><span class="string">metadata:</span></span><br><span class="line"><span class="symbol">  labels:</span></span><br><span class="line">    k8s-<span class="string">app:</span> kubernetes-dashboard</span><br><span class="line"><span class="symbol">  name:</span> kubernetes-dashboard-csrf</span><br><span class="line"><span class="symbol">  namespace:</span> kube-system</span><br><span class="line"><span class="string">type:</span> Opaque</span><br><span class="line"><span class="string">data:</span></span><br><span class="line"><span class="symbol">  csrf:</span> <span class="string">""</span></span><br><span class="line">---</span><br><span class="line"><span class="string">apiVersion:</span> v1</span><br><span class="line"><span class="string">kind:</span> Secret</span><br><span class="line"><span class="string">metadata:</span></span><br><span class="line"><span class="symbol">  labels:</span></span><br><span class="line">    k8s-<span class="string">app:</span> kubernetes-dashboard</span><br><span class="line"><span class="symbol">  name:</span> kubernetes-dashboard-key-holder</span><br><span class="line"><span class="symbol">  namespace:</span> kube-system</span><br><span class="line"><span class="string">type:</span> Opaque</span><br><span class="line">---</span><br><span class="line"><span class="string">kind:</span> ConfigMap</span><br><span class="line"><span class="string">apiVersion:</span> v1</span><br><span class="line"><span class="string">metadata:</span></span><br><span class="line"><span class="symbol">  labels:</span></span><br><span class="line">    k8s-<span class="string">app:</span> kubernetes-dashboard</span><br><span class="line"><span class="symbol">  name:</span> kubernetes-dashboard-settings</span><br><span class="line"><span class="symbol">  namespace:</span> kube-system</span><br></pre></td></tr></table></figure><p>部署 Dashboard Config &amp; Secret</p><ul><li>kubectl apply -f k8s-dashboard-configmap-secret.yaml</li></ul><h3 id="kubernetes-dashboard"><a href="#kubernetes-dashboard" class="headerlink" title="kubernetes-dashboard"></a>kubernetes-dashboard</h3><p>创建 Dashboard Deploy 部署文件<br>k8s-dashboard-deploy.yaml</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">kind: Service</span><br><span class="line">apiVersion: v1</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    k8s-app: kubernetes-dashboard</span><br><span class="line">  name: kubernetes-dashboard</span><br><span class="line">  namespace: kube-system</span><br><span class="line">spec:</span><br><span class="line">  type: NodePort</span><br><span class="line">  ports:</span><br><span class="line">    - port: 443</span><br><span class="line">      nodePort: 30001</span><br><span class="line">      targetPort: 8443</span><br><span class="line">  selector:</span><br><span class="line">    k8s-app: kubernetes-dashboard</span><br><span class="line">---</span><br><span class="line">## Dashboard Deployment</span><br><span class="line">kind: Deployment</span><br><span class="line">apiVersion: apps&#x2F;v1</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    k8s-app: kubernetes-dashboard</span><br><span class="line">  name: kubernetes-dashboard</span><br><span class="line">  namespace: kube-system</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  revisionHistoryLimit: 10</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      k8s-app: kubernetes-dashboard</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        k8s-app: kubernetes-dashboard</span><br><span class="line">    spec:</span><br><span class="line">      serviceAccountName: kubernetes-dashboard</span><br><span class="line">      containers:</span><br><span class="line">        - name: kubernetes-dashboard</span><br><span class="line">          image: kubernetesui&#x2F;dashboard:v2.0.1</span><br><span class="line">          securityContext:</span><br><span class="line">            allowPrivilegeEscalation: false</span><br><span class="line">            readOnlyRootFilesystem: true</span><br><span class="line">            runAsUser: 1001</span><br><span class="line">            runAsGroup: 2001</span><br><span class="line">          ports:</span><br><span class="line">            - containerPort: 8443</span><br><span class="line">              protocol: TCP</span><br><span class="line">          args:</span><br><span class="line">            - --auto-generate-certificates</span><br><span class="line">            - --namespace&#x3D;kube-system          #设置为当前部署的Namespace</span><br><span class="line">          resources:</span><br><span class="line">            limits:</span><br><span class="line">              cpu: 1000m</span><br><span class="line">              memory: 512Mi</span><br><span class="line">            requests:</span><br><span class="line">              cpu: 1000m</span><br><span class="line">              memory: 512Mi</span><br><span class="line">          livenessProbe:</span><br><span class="line">            httpGet:</span><br><span class="line">              scheme: HTTPS</span><br><span class="line">              path: &#x2F;</span><br><span class="line">              port: 8443</span><br><span class="line">            initialDelaySeconds: 30</span><br><span class="line">            timeoutSeconds: 30</span><br><span class="line">          volumeMounts:</span><br><span class="line">            - name: kubernetes-dashboard-certs</span><br><span class="line">              mountPath: &#x2F;certs</span><br><span class="line">            - name: tmp-volume</span><br><span class="line">              mountPath: &#x2F;tmp</span><br><span class="line">            - name: localtime</span><br><span class="line">              readOnly: true</span><br><span class="line">              mountPath: &#x2F;etc&#x2F;localtime</span><br><span class="line">      volumes:</span><br><span class="line">        - name: kubernetes-dashboard-certs</span><br><span class="line">          secret:</span><br><span class="line">            secretName: kubernetes-dashboard-certs</span><br><span class="line">        - name: tmp-volume</span><br><span class="line">          emptyDir: &#123;&#125;</span><br><span class="line">        - name: localtime</span><br><span class="line">          hostPath:</span><br><span class="line">            type: File</span><br><span class="line">            path: &#x2F;etc&#x2F;localtime</span><br><span class="line">      tolerations:</span><br><span class="line">        - key: node-role.kubernetes.io&#x2F;master</span><br><span class="line">          effect: NoSchedule</span><br></pre></td></tr></table></figure><p>部署 Dashboard Deploy</p><ul><li>kubectl apply -f k8s-dashboard-deploy.yaml</li></ul><h3 id="创建-kubernetes-metrics-scraper"><a href="#创建-kubernetes-metrics-scraper" class="headerlink" title="创建 kubernetes-metrics-scraper"></a>创建 kubernetes-metrics-scraper</h3><p>创建 Dashboard Metrics 部署文件</p><p>k8s-dashboard-metrics.yaml</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">kind: Service</span><br><span class="line">apiVersion: v1</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    k8s-app: dashboard-metrics-scraper</span><br><span class="line">  name: dashboard-metrics-scraper</span><br><span class="line">  namespace: kube-system</span><br><span class="line">spec:</span><br><span class="line">  ports:</span><br><span class="line">    - port: 8000</span><br><span class="line">      targetPort: 8000</span><br><span class="line">  selector:</span><br><span class="line">    k8s-app: dashboard-metrics-scraper</span><br><span class="line">---</span><br><span class="line">## Dashboard Metrics Deployment</span><br><span class="line">kind: Deployment</span><br><span class="line">apiVersion: apps&#x2F;v1</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    k8s-app: dashboard-metrics-scraper</span><br><span class="line">  name: dashboard-metrics-scraper</span><br><span class="line">  namespace: kube-system</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  revisionHistoryLimit: 10</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      k8s-app: dashboard-metrics-scraper</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        k8s-app: dashboard-metrics-scraper</span><br><span class="line">      annotations:</span><br><span class="line">        seccomp.security.alpha.kubernetes.io&#x2F;pod: &#39;runtime&#x2F;default&#39;</span><br><span class="line">    spec:</span><br><span class="line">      serviceAccountName: kubernetes-dashboard</span><br><span class="line">      containers:</span><br><span class="line">        - name: dashboard-metrics-scraper</span><br><span class="line">          image: kubernetesui&#x2F;metrics-scraper:v1.0.4</span><br><span class="line">          securityContext:</span><br><span class="line">            allowPrivilegeEscalation: false</span><br><span class="line">            readOnlyRootFilesystem: true</span><br><span class="line">            runAsUser: 1001</span><br><span class="line">            runAsGroup: 2001</span><br><span class="line">          ports:</span><br><span class="line">            - containerPort: 8000</span><br><span class="line">              protocol: TCP</span><br><span class="line">          resources:</span><br><span class="line">            limits:</span><br><span class="line">              cpu: 1000m</span><br><span class="line">              memory: 512Mi</span><br><span class="line">            requests:</span><br><span class="line">              cpu: 1000m</span><br><span class="line">              memory: 512Mi</span><br><span class="line">          livenessProbe:</span><br><span class="line">            httpGet:</span><br><span class="line">              scheme: HTTP</span><br><span class="line">              path: &#x2F;</span><br><span class="line">              port: 8000</span><br><span class="line">            initialDelaySeconds: 30</span><br><span class="line">            timeoutSeconds: 30</span><br><span class="line">          volumeMounts:</span><br><span class="line">          - mountPath: &#x2F;tmp</span><br><span class="line">            name: tmp-volume</span><br><span class="line">          - name: localtime</span><br><span class="line">            readOnly: true</span><br><span class="line">            mountPath: &#x2F;etc&#x2F;localtime</span><br><span class="line">      volumes:</span><br><span class="line">        - name: tmp-volume</span><br><span class="line">          emptyDir: &#123;&#125;</span><br><span class="line">        - name: localtime</span><br><span class="line">          hostPath:</span><br><span class="line">            type: File</span><br><span class="line">            path: &#x2F;etc&#x2F;localtime</span><br><span class="line">      nodeSelector:</span><br><span class="line">        &quot;beta.kubernetes.io&#x2F;os&quot;: linux</span><br><span class="line">      tolerations:</span><br><span class="line">        - key: node-role.kubernetes.io&#x2F;master</span><br><span class="line">          effect: NoSchedule</span><br></pre></td></tr></table></figure><p>部署 Dashboard Metrics</p><ul><li>kubectl apply -f k8s-dashboard-metrics.yaml</li></ul><h3 id="创建访问的-ServiceAccount"><a href="#创建访问的-ServiceAccount" class="headerlink" title="创建访问的 ServiceAccount"></a>创建访问的 ServiceAccount</h3><p>创建一个绑定 admin 权限的 ServiceAccount，获取其 Token 用于访问看板。</p><p>创建 Dashboard ServiceAccount 部署文件</p><p>k8s-dashboard-token.yaml</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">kind: ClusterRoleBinding</span><br><span class="line">apiVersion: rbac.authorization.k8s.io&#x2F;v1</span><br><span class="line">metadata:</span><br><span class="line">  name: admin</span><br><span class="line">  annotations:</span><br><span class="line">    rbac.authorization.kubernetes.io&#x2F;autoupdate: &quot;true&quot;</span><br><span class="line">roleRef:</span><br><span class="line">  kind: ClusterRole</span><br><span class="line">  name: cluster-admin</span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br><span class="line">subjects:</span><br><span class="line">- kind: ServiceAccount</span><br><span class="line">  name: admin</span><br><span class="line">  namespace: kube-system</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ServiceAccount</span><br><span class="line">metadata:</span><br><span class="line">  name: admin</span><br><span class="line">  namespace: kube-system</span><br><span class="line">  labels:</span><br><span class="line">    kubernetes.io&#x2F;cluster-service: &quot;true&quot;</span><br><span class="line">    addonmanager.kubernetes.io&#x2F;mode: Reconcile</span><br></pre></td></tr></table></figure><p>部署访问的 ServiceAccount</p><ul><li>kubectl apply -f k8s-dashboard-token.yaml</li></ul><h4 id="获取-Token"><a href="#获取-Token" class="headerlink" title="获取 Token"></a>获取 Token</h4><ul><li>kubectl describe secret/$(kubectl get secret -n kube-system |grep admin|awk ‘{print $1}’) -n kube-system</li></ul><p>token：</p><p>xxxxxxxx.xxxxxxx.xxxxxx</p><h4 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h4><p><a href="https://10.0.0.128:30001" target="_blank" rel="noopener">https://10.0.0.128:30001</a> </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;环境&quot;&gt;&lt;a href=&quot;#环境&quot; class=&quot;headerlink&quot; title=&quot;环境&quot;&gt;&lt;/a&gt;环境&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;环境&lt;/th&gt;
&lt;th align=&quot;right&quot;&gt;说明&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
      
    
    </summary>
    
    
      <category term="容器云" scheme="http://btbib.com/categories/%E5%AE%B9%E5%99%A8%E4%BA%91/"/>
    
    
      <category term="k8s" scheme="http://btbib.com/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>技术Leader的30条军规</title>
    <link href="http://btbib.com/2020-05-11-1.html"/>
    <id>http://btbib.com/2020-05-11-1.html</id>
    <published>2020-05-11T06:16:25.000Z</published>
    <updated>2020-05-11T07:33:25.000Z</updated>
    
    <content type="html"><![CDATA[<p><strong>骑白马的不一定是王子，可能是唐僧；有翅膀的不一定是天使，也可能是鸟人。</strong></p><h4 id="1、-组建12人左右的最小战斗单元。"><a href="#1、-组建12人左右的最小战斗单元。" class="headerlink" title="1、 组建12人左右的最小战斗单元。"></a>1、 组建12人左右的最小战斗单元。</h4><p>有时候人多并没有用，比如一个孕妇怀胎10月生下一个宝宝，你不可能找来10个孕妇怀胎一个月，就能生下来吧。</p><h4 id="2、每两周一个迭代，并持续对产品方向做对焦，打造杀手级应用。"><a href="#2、每两周一个迭代，并持续对产品方向做对焦，打造杀手级应用。" class="headerlink" title="2、每两周一个迭代，并持续对产品方向做对焦，打造杀手级应用。"></a>2、每两周一个迭代，并持续对产品方向做对焦，打造杀手级应用。</h4><p>在VUCA时代（是指变化莫测的时代），只有打造极致的产品和服务，才有机会胜出。就像奔驰的广告语：The best or nothing。</p><h4 id="3、高效会议，会前发出议题，与会人提前做准备，会议要有结论，执行结果有跟踪。"><a href="#3、高效会议，会前发出议题，与会人提前做准备，会议要有结论，执行结果有跟踪。" class="headerlink" title="3、高效会议，会前发出议题，与会人提前做准备，会议要有结论，执行结果有跟踪。"></a>3、高效会议，会前发出议题，与会人提前做准备，会议要有结论，执行结果有跟踪。</h4><p>尽量心平气和地讨论，你每次忍不住骂别人的时候，要考虑对方的感受，尽量不要用方言，因为对方会听不懂。</p><h4 id="4、使用时间管理工具，每天做时间计划，发送给你的直属领导和团队。"><a href="#4、使用时间管理工具，每天做时间计划，发送给你的直属领导和团队。" class="headerlink" title="4、使用时间管理工具，每天做时间计划，发送给你的直属领导和团队。"></a>4、使用时间管理工具，每天做时间计划，发送给你的直属领导和团队。</h4><p>时间最牛逼了，它不用通知任何人，就能改变一切。要掌握的工具有：番茄工作法、GTD工具或App。</p><h4 id="5、每周做团队效率分析，包括资源使用率、评估团队产出、KPI完成情况。"><a href="#5、每周做团队效率分析，包括资源使用率、评估团队产出、KPI完成情况。" class="headerlink" title="5、每周做团队效率分析，包括资源使用率、评估团队产出、KPI完成情况。"></a>5、每周做团队效率分析，包括资源使用率、评估团队产出、KPI完成情况。</h4><p>鼓励团队挑战高目标，比如一次下雨天，有辆兰博基尼经过，溅了我一身水，当时我就发誓，等我有钱了，一定买一身雨衣。</p><h4 id="6、组织团队内部分享、交流心得，将最佳实践更新到WIKI上。"><a href="#6、组织团队内部分享、交流心得，将最佳实践更新到WIKI上。" class="headerlink" title="6、组织团队内部分享、交流心得，将最佳实践更新到WIKI上。"></a>6、组织团队内部分享、交流心得，将最佳实践更新到WIKI上。</h4><p>比如最近股市行情那么差，炒股亏了多少，说出来大家高兴高兴。需要使用到的工具和方法有：GROW模型、TTT培训。</p><h4 id="7、采用Scrum或Kanban等敏捷开发模式，持续提升团队成熟度。"><a href="#7、采用Scrum或Kanban等敏捷开发模式，持续提升团队成熟度。" class="headerlink" title="7、采用Scrum或Kanban等敏捷开发模式，持续提升团队成熟度。"></a>7、采用Scrum或Kanban等敏捷开发模式，持续提升团队成熟度。</h4><p>Leader能够担任敏捷教练，指导团队快速迭代，自我完善。集体反思复盘是非常重要的，当一个人说我丑的时我不以为然，当越来越多人说我丑的时候，我才知道现在骗子越来越多了。</p><h4 id="8、每周周会，提出Team的HighLight、LowLight和需要改进的地方、下周完成的改进点。"><a href="#8、每周周会，提出Team的HighLight、LowLight和需要改进的地方、下周完成的改进点。" class="headerlink" title="8、每周周会，提出Team的HighLight、LowLight和需要改进的地方、下周完成的改进点。"></a>8、每周周会，提出Team的HighLight、LowLight和需要改进的地方、下周完成的改进点。</h4><p>有的同事加个班还发朋友圈，恨不得让全世界都知道，这是不成熟的表现，我就不一样，我只想让领导知道。</p><h4 id="9、学习邮件礼仪，善用邮件组过滤功能，提高邮件处理效率。"><a href="#9、学习邮件礼仪，善用邮件组过滤功能，提高邮件处理效率。" class="headerlink" title="9、学习邮件礼仪，善用邮件组过滤功能，提高邮件处理效率。"></a>9、学习邮件礼仪，善用邮件组过滤功能，提高邮件处理效率。</h4><p>需要掌握的工具方法有：基于金字塔原理、MECE的文字表达方式。凡事发邮件的习惯非常好，因为撕逼的时候可以拿出来当证据。</p><h4 id="10、Sprint中的TASK粒度在0-5-1天之内。"><a href="#10、Sprint中的TASK粒度在0-5-1天之内。" class="headerlink" title="10、Sprint中的TASK粒度在0.5~1天之内。"></a>10、Sprint中的TASK粒度在0.5~1天之内。</h4><p>颗粒度的大小，都要有个度。比如找女朋友就要找个胖的，花同样的钱你挑了个最大的，不好吗？</p><h4 id="11、每天跟团队开站会，及时发现和解决项目中的问题。"><a href="#11、每天跟团队开站会，及时发现和解决项目中的问题。" class="headerlink" title="11、每天跟团队开站会，及时发现和解决项目中的问题。"></a>11、每天跟团队开站会，及时发现和解决项目中的问题。</h4><p>如果Leader还要Coding，先确保团队的工作正常进行，再去写自己的代码，切忌重心颠倒。</p><h4 id="12、Product-backlog里随时有足够团队开发一个月的需求设计，确保一个迭代完成可马上进入下一迭代，团队“零等待”。"><a href="#12、Product-backlog里随时有足够团队开发一个月的需求设计，确保一个迭代完成可马上进入下一迭代，团队“零等待”。" class="headerlink" title="12、Product backlog里随时有足够团队开发一个月的需求设计，确保一个迭代完成可马上进入下一迭代，团队“零等待”。"></a>12、Product backlog里随时有足够团队开发一个月的需求设计，确保一个迭代完成可马上进入下一迭代，团队“零等待”。</h4><p>普通Leader从头盯到尾，高手狠抓衔接环节，比如从需求评审到开发，从开发转测试，中间衔接不上是最常见的浪费。精益“拉动式”生产的灵魂就是，减少在制品的等待时长。</p><h4 id="13、异地团队协作，必须有接口人，由接口人负责日常需求沟通，保持1对1沟通，禁止多对多的网状沟通。"><a href="#13、异地团队协作，必须有接口人，由接口人负责日常需求沟通，保持1对1沟通，禁止多对多的网状沟通。" class="headerlink" title="13、异地团队协作，必须有接口人，由接口人负责日常需求沟通，保持1对1沟通，禁止多对多的网状沟通。"></a>13、异地团队协作，必须有接口人，由接口人负责日常需求沟通，保持1对1沟通，禁止多对多的网状沟通。</h4><p>疫情逼得我们提前适应了云办公，但是视频会议的时候，要注意礼仪，至少洗个头、画下眉毛眼睛、下身要穿点什么，别着凉。</p><h4 id="14、Scrum中的工时预估必须double-check，有争议需提交技术Leader进行裁决。"><a href="#14、Scrum中的工时预估必须double-check，有争议需提交技术Leader进行裁决。" class="headerlink" title="14、Scrum中的工时预估必须double check，有争议需提交技术Leader进行裁决。"></a>14、Scrum中的工时预估必须double check，有争议需提交技术Leader进行裁决。</h4><p>需要掌握的方法：故事点、扑克估算。讨论问题的时候要提高效率，有些同学讨论半天，最后还动手了，结果还是没解决，我不一样，我上来直接打。</p><h4 id="15、遵守Code-review规范，使用sonar，findbugs等工具做静态扫描，减少低级错误。"><a href="#15、遵守Code-review规范，使用sonar，findbugs等工具做静态扫描，减少低级错误。" class="headerlink" title="15、遵守Code review规范，使用sonar，findbugs等工具做静态扫描，减少低级错误。"></a>15、遵守Code review规范，使用sonar，findbugs等工具做静态扫描，减少低级错误。</h4><p>Code review既达成代码审查目的，又可以分享团队成员的经验。一举两得的事，要坚持。</p><h4 id="16、项目管理，使用Jira、readmine等工具提效。数据可视化、透明化带来效率提升。"><a href="#16、项目管理，使用Jira、readmine等工具提效。数据可视化、透明化带来效率提升。" class="headerlink" title="16、项目管理，使用Jira、readmine等工具提效。数据可视化、透明化带来效率提升。"></a>16、项目管理，使用Jira、readmine等工具提效。数据可视化、透明化带来效率提升。</h4><p>虽说，开兰博基尼和拖拉机，都可以到达终点，但是兰博基尼能泡到嫩模，拖拉机只能泡到村姑，这大概就是差别吧。</p><h4 id="17、每周测试leader做bug分析、开发leader代码质量问题分析、维护到WIKI。"><a href="#17、每周测试leader做bug分析、开发leader代码质量问题分析、维护到WIKI。" class="headerlink" title="17、每周测试leader做bug分析、开发leader代码质量问题分析、维护到WIKI。"></a>17、每周测试leader做bug分析、开发leader代码质量问题分析、维护到WIKI。</h4><p>质量的第一责任人是开发自己，而不是测试。注意提bug的礼仪，可以这样说，我Cao，这个算法太牛X了，哪个大神写的？当一群开发围过来的时候，指着头发最多的那个，这bug就是你的，滚回去改！</p><h4 id="18、每周例会让成员展示工作成果，如：设计、算法等，增加员工成就感。"><a href="#18、每周例会让成员展示工作成果，如：设计、算法等，增加员工成就感。" class="headerlink" title="18、每周例会让成员展示工作成果，如：设计、算法等，增加员工成就感。"></a>18、每周例会让成员展示工作成果，如：设计、算法等，增加员工成就感。</h4><p>周会增强仪式感，让员工从工作中获得成就感，得到快乐。我每天上班都很注重仪式感，开始工作之前，做好计划、思考一天最重要的事情、冥想解决的最佳办法，然后，然后就下班了。</p><h4 id="19、每天跟组员有沟通，一起吃饭，关心生活，异地同事多进行语音交流替代打字。"><a href="#19、每天跟组员有沟通，一起吃饭，关心生活，异地同事多进行语音交流替代打字。" class="headerlink" title="19、每天跟组员有沟通，一起吃饭，关心生活，异地同事多进行语音交流替代打字。"></a>19、每天跟组员有沟通，一起吃饭，关心生活，异地同事多进行语音交流替代打字。</h4><p>同事之间相处，就不要耍心机了，反正几十年后都要一起去跳广场舞的。</p><h4 id="20、对表现突出的员工，公开邮件表扬，申请即时奖励，事迹更新到wiki。"><a href="#20、对表现突出的员工，公开邮件表扬，申请即时奖励，事迹更新到wiki。" class="headerlink" title="20、对表现突出的员工，公开邮件表扬，申请即时奖励，事迹更新到wiki。"></a>20、对表现突出的员工，公开邮件表扬，申请即时奖励，事迹更新到wiki。</h4><p>当然了，用钱并不能买到快乐，只是有钱，别人会想尽办法让你快乐。所以，要努力工作，多挣钱。</p><h4 id="21、跟组员每月一次one-on-one，帮助解决工作和生活中遇到的问题。"><a href="#21、跟组员每月一次one-on-one，帮助解决工作和生活中遇到的问题。" class="headerlink" title="21、跟组员每月一次one on one，帮助解决工作和生活中遇到的问题。"></a>21、跟组员每月一次one on one，帮助解决工作和生活中遇到的问题。</h4><p>比如员工找不到对象，要劝他不要怨天尤人，要多想想自己的原因，也许是因为他太优秀了，没人配得上他呢。</p><h4 id="22、每月一次团队活动，如：桌游、体育活动。"><a href="#22、每月一次团队活动，如：桌游、体育活动。" class="headerlink" title="22、每月一次团队活动，如：桌游、体育活动。"></a>22、每月一次团队活动，如：桌游、体育活动。</h4><p>多鼓励单身码农们，认认真真去谈一次恋爱，不然他们根本不知道一个人过得有多爽。</p><h4 id="23、员工生日时，给员工送上有纪念意义的小礼物，增强归属感。"><a href="#23、员工生日时，给员工送上有纪念意义的小礼物，增强归属感。" class="headerlink" title="23、员工生日时，给员工送上有纪念意义的小礼物，增强归属感。"></a>23、员工生日时，给员工送上有纪念意义的小礼物，增强归属感。</h4><p>你很可能是他生命中除了父母、银行、各种App之外，唯一记住他生日的人。</p><h4 id="24、每月更新团队“文化墙”，展示团队风貌。"><a href="#24、每月更新团队“文化墙”，展示团队风貌。" class="headerlink" title="24、每月更新团队“文化墙”，展示团队风貌。"></a>24、每月更新团队“文化墙”，展示团队风貌。</h4><p>给团队定制Logo、标语、队服等等，像一大家子那样。比如一句走心的Slogan：就算做咸鱼，也要做最咸的那一条。</p><h4 id="25、每季度举行部门会议，总结部门季度工作，嘉奖表现突出、进步快的员工。"><a href="#25、每季度举行部门会议，总结部门季度工作，嘉奖表现突出、进步快的员工。" class="headerlink" title="25、每季度举行部门会议，总结部门季度工作，嘉奖表现突出、进步快的员工。"></a>25、每季度举行部门会议，总结部门季度工作，嘉奖表现突出、进步快的员工。</h4><p>物质激励之外，精神激励同样重要，物质激励像父爱那样厚重，精神激励像母爱那样绵长。</p><h4 id="26、每季度举行部门outing，增加团队凝聚力。"><a href="#26、每季度举行部门outing，增加团队凝聚力。" class="headerlink" title="26、每季度举行部门outing，增加团队凝聚力。"></a>26、每季度举行部门outing，增加团队凝聚力。</h4><p>出去旅游的话，多做些攻略，最好的攻略可以浓缩成四个字：多带点钱。</p><h4 id="27、团队内建立backup机制，实行A-B角，包括Leader自己。"><a href="#27、团队内建立backup机制，实行A-B角，包括Leader自己。" class="headerlink" title="27、团队内建立backup机制，实行A/B角，包括Leader自己。"></a>27、团队内建立backup机制，实行A/B角，包括Leader自己。</h4><p>避免因为团队成员升迁或离职造成项目进度的延期。备胎转正，是一条成功的捷径。</p><h4 id="28、使用情境领导方法，管理和培养不同等级的员工。"><a href="#28、使用情境领导方法，管理和培养不同等级的员工。" class="headerlink" title="28、使用情境领导方法，管理和培养不同等级的员工。"></a>28、使用情境领导方法，管理和培养不同等级的员工。</h4><p>掌握：情景领导方法、九宫格人才盘点等方法。还是任正非说得有道理，什么是人才？钱给够了，不是人才也会变成人才。我终于明白自己这么多年，不能成为人才的真正原因了。</p><h4 id="29、帮助员工做职业规划，每月制定提升计划，监督完成情况。"><a href="#29、帮助员工做职业规划，每月制定提升计划，监督完成情况。" class="headerlink" title="29、帮助员工做职业规划，每月制定提升计划，监督完成情况。"></a>29、帮助员工做职业规划，每月制定提升计划，监督完成情况。</h4><p>让员工明白一个道理，年轻的时候不要怕吃苦，因为只有这样，当你老了吃苦的时候才会习惯。</p><h4 id="30、鼓励下属反馈问题，主动向下沟通，鼓励大家发表观点。"><a href="#30、鼓励下属反馈问题，主动向下沟通，鼓励大家发表观点。" class="headerlink" title="30、鼓励下属反馈问题，主动向下沟通，鼓励大家发表观点。"></a>30、鼓励下属反馈问题，主动向下沟通，鼓励大家发表观点。</h4><p>在团队中鼓励积极向上的人生态度。假如生活欺骗了你，不要着急，拿出美颜相机，去欺骗生活。</p><hr><p>作者| Mr.K   编辑| Emma<br>来源| 技术领导力(ID：jishulingdaoli)</p><hr>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;strong&gt;骑白马的不一定是王子，可能是唐僧；有翅膀的不一定是天使，也可能是鸟人。&lt;/strong&gt;&lt;/p&gt;
&lt;h4 id=&quot;1、-组建12人左右的最小战斗单元。&quot;&gt;&lt;a href=&quot;#1、-组建12人左右的最小战斗单元。&quot; class=&quot;headerlink&quot; tit
      
    
    </summary>
    
    
      <category term="管理" scheme="http://btbib.com/categories/%E7%AE%A1%E7%90%86/"/>
    
    
      <category term="Leader" scheme="http://btbib.com/tags/Leader/"/>
    
  </entry>
  
  <entry>
    <title>MySQL数据库开发规范</title>
    <link href="http://btbib.com/2020-03-27-3.html"/>
    <id>http://btbib.com/2020-03-27-3.html</id>
    <published>2020-03-27T00:50:26.000Z</published>
    <updated>2020-03-28T07:55:13.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="一-数据库核心规范"><a href="#一-数据库核心规范" class="headerlink" title="一. 数据库核心规范"></a>一. 数据库核心规范</h2><ol><li>尽量不要在数据库做运算：cpu计算请移至业务层.</li><li>控制单表数据量：单表记录控制在1000w行.（也可以考虑分区）</li><li>控制列数量：单表字段数上限控制在20到50之内.字段少而精可以提高并发，IO更高效 (<a href="http://imysql.com/2014/09/28/mysql-optimization-case-blob-stored-in-innodb-optimization.shtml" target="_blank" rel="noopener">优化InnoDB表BLOB列的存储效率</a>)</li><li>平衡范式与冗余：效率优先，提高性能. 适时牺牲范式增加冗余</li><li>拒绝3B：拒绝大sql(BIG SQL)，大事务(BIG TRANSATION)，大批量(BIG BATCH).</li></ol><h2 id="二-命名规范"><a href="#二-命名规范" class="headerlink" title="二. 命名规范"></a>二. 命名规范</h2><p>在MySQL数据库中，表名、字段名、触发器、存储过程以及函数的命名，统一采用26个英文字母（区分大小写）和0－9这十个自然数，加上下划线_组成，共63个字符.不能出现其他字符（注释除外）,也不能以数字或‘_’ 开头，非必须情况下，不使用自然数.</p><p>对于MySQL数据库， 表名、字段名统一采用小写字母; (Oracle数据库中表名、字段名统一采用大写字母)若名称过长可采用单词缩写.</p><h3 id="1-表名"><a href="#1-表名" class="headerlink" title="1. 表名:"></a>1. 表名:</h3><p>根据表所描述的业务实体，采用英文单词加<code>_</code>的形式命名.若表名太长，英文单词可采用缩写.如：<code>prodcut_info</code>.</p><h3 id="2-视图命名："><a href="#2-视图命名：" class="headerlink" title="2. 视图命名："></a>2. 视图命名：</h3><p>视图名加<code>_view”后缀</code>。 如：<code>prodcut_info_view</code>.</p><p>MySQL因为没有物化视图，因此视图能不用就尽量少用。对于sql监控来讲，视图的sql存储在数据库中，分析时很不直观。</p><h3 id="3-触发器命名："><a href="#3-触发器命名：" class="headerlink" title="3. 触发器命名："></a>3. 触发器命名：</h3><p>触发器功能描述名加“<code>_tr</code>”后缀。 如:<code>insert_balance_hist_tr</code>.</p><h3 id="4-存储过程："><a href="#4-存储过程：" class="headerlink" title="4. 存储过程："></a>4. 存储过程：</h3><p>存储过程功能描述名加“<code>_sp</code>”后缀。如：<code>load_user_trade_sp</code>.</p><h3 id="5-函数名："><a href="#5-函数名：" class="headerlink" title="5. 函数名："></a>5. 函数名：</h3><p>函数功能描述加“<code>_fn</code>”后缀。 如：<code>generate_password_fn</code>.</p><h3 id="6-键名："><a href="#6-键名：" class="headerlink" title="6. 键名："></a>6. 键名：</h3><ul><li>主键：主键字段或主键描述加“<code>_pk</code>” 如：<code>product_id_pk</code></li><li>外键：外键字段 加“_fk” 如：<code>product_id_fk</code></li><li>索引：索引字段或索引描述 加 <code>_idx</code> 如：<code>name_idx</code>.</li></ul><h2 id="三-设计规范"><a href="#三-设计规范" class="headerlink" title="三.设计规范"></a>三.设计规范</h2><h3 id="1-注释"><a href="#1-注释" class="headerlink" title="1. 注释"></a>1. 注释</h3><p>表结构中须包含表注释和列注释. 对于函数、触发器以及存储过程等，代码开头应有阐述其功能的注释.若有复杂逻辑，则应加上局部注释.</p><h3 id="2-数据引擎选择"><a href="#2-数据引擎选择" class="headerlink" title="2. 数据引擎选择"></a>2. 数据引擎选择</h3><p>全部选择<code>InnoDB</code>。<code>MyISAM</code>一旦出现系统宕机或者进程崩溃情况容易造成存储数据损坏。</p><p>此外，频繁读写的InnoDB表，一定要使用具有自增/顺序特征的整型作为显式主键。</p><p><a href="http://imysql.com/2014/09/14/mysql-faq-why-innodb-table-using-autoinc-int-as-pk.shtml" target="_blank" rel="noopener">为什么InnoDB表要建议用自增列做主键</a></p><h3 id="3-编码"><a href="#3-编码" class="headerlink" title="3. 编码"></a>3. 编码</h3><p>所有数据表均采用<code>UTF8</code>编码，并在表DDL中明确标出.所有字段都不单独设编码，即采用默认的表编码<code>UTF8</code>.</p><p>比如可以设置表的编码</p><pre><code>CREATE DATABASE IF NOT EXISTS test_db default charset utf8 COLLATE utf8_general_ci;</code></pre><p>注意后面这句话<code>COLLATE utf8_general_ci</code>,意思是在排序时根据utf8校验集来排序，那么在这个数据库下创建的所有数据表的默认字符集都会是utf8了</p><h3 id="4-字段选择"><a href="#4-字段选择" class="headerlink" title="4. 字段选择"></a>4. 字段选择</h3><h4 id="4-1-IP字段"><a href="#4-1-IP字段" class="headerlink" title="4.1 IP字段"></a>4.1 IP字段</h4><p>如果是使用的IPV4，则使用<code>int</code>存储不使用char(15).</p><p>在MySQL中提供了<code>INER_ATONO()</code>和<code>INET_NTOA()</code>函数来对IP和数字之间进行转换. 前者提供IP到数字的转换后者提供数字到IP的转换.</p><pre><code>insert into table column(ipvalues(INET_ATONO(&apos;127.0.0.1&apos;)) ;</code></pre><p>如业务需求需要存储IPV6，可采用<code>varchar(40)</code>类型.</p><h4 id="4-2-手机字段"><a href="#4-2-手机字段" class="headerlink" title="4.2 手机字段"></a>4.2 手机字段</h4><p>如果考虑到<code>varchar</code>占用空间大影响查询性能，请使用<code>bigint</code>来存储手机号码.</p><ul><li>不要使用<code>int</code>，因为<code>int</code>类型的最大长度不能超过11位</li><li>如果手机号码中含有地区码，则用<code>varchar</code></li></ul><h4 id="4-3-enum，set和tinyint类型使用"><a href="#4-3-enum，set和tinyint类型使用" class="headerlink" title="4.3 enum，set和tinyint类型使用"></a>4.3 <code>enum</code>，<code>set</code>和<code>tinyint</code>类型使用</h4><p>枚举类型可以使用ENUM，ENUM的内部存储机制是采用TINYINT或SMALLINT（并非CHAR/VARCHAR）。</p><p>注意：ENUM类型扩展性较差，如果新增枚举值，需要修改表字段定义，而且在执行ddl时会对性能有影响</p><h4 id="4-4-金额字段"><a href="#4-4-金额字段" class="headerlink" title="4.4 金额字段"></a>4.4 金额字段</h4><p>对于金额字段，统一采用<code>decimal(17,0)</code>类型，金额以“分”为单位保存.</p><h4 id="4-5-时间字段"><a href="#4-5-时间字段" class="headerlink" title="4.5 时间字段"></a>4.5 时间字段</h4><p>时间字段优先考虑<code>datetime</code>.</p><h4 id="4-6-精确浮点数字段必须使用decimal替代float和double"><a href="#4-6-精确浮点数字段必须使用decimal替代float和double" class="headerlink" title="4.6 精确浮点数字段必须使用decimal替代float和double"></a>4.6 精确浮点数字段必须使用decimal替代float和double</h4><p>MySQL中的数值类型(不包括整型)IEEE754浮点数：单精度(<code>float</code>)、双精度(<code>double</code>和<code>real</code>)、 定点数(<code>decimal</code>和<code>numeric</code>).</p><p><code>float</code>，<code>double</code>等非标准类型，在DB中保存的是近似值，而<code>decimal</code>则以字符串的形式保存数值</p><h4 id="4-7-辅助字段"><a href="#4-7-辅助字段" class="headerlink" title="4.7 辅助字段"></a>4.7 辅助字段</h4><p>为便于数据分析，所有表必须添加两个字段：</p><pre><code>raw_add_time timestamp DEFAULT CURRENT_TIMESTAMP COMMENT &apos;创建时间&apos;,raw_update_time timestamp DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT &apos;修改时间&apos;</code></pre><p>这两个字段只记录每条记录的创建时间及更新时间.</p><h3 id="5-禁止在数据库里存图片和文件"><a href="#5-禁止在数据库里存图片和文件" class="headerlink" title="5 禁止在数据库里存图片和文件"></a>5 禁止在数据库里存图片和文件</h3><p>禁止在数据库中使用<code>varbinary</code>、<code>blob</code>、<code>text</code>存储图片和文件.</p><h3 id="6-数据库完整性要求"><a href="#6-数据库完整性要求" class="headerlink" title="6 数据库完整性要求"></a>6 数据库完整性要求</h3><p>不在数据库层面约束数据的完整性，数据的完整性由程序来保证.</p><p>所以也禁止使用外键。</p><h2 id="四-索引规范"><a href="#四-索引规范" class="headerlink" title="四. 索引规范"></a>四. 索引规范</h2><p>MySQL的查询速度依赖良好的索引设计，因此索引对于高性能至关重要.</p><p>合理的索引(哪怕是基于索引的条件过滤，如果优化器意识到总共需要扫描的数据量超过30%时，就会直接改变执行计划为全表扫描，不再使用索引。)会加快查询速度(包括UPDATE和DELETE的速度，MySQL会将包含该行的page加载到内存中，然后进行UPDATE或者DELETE操作),不合理的索引会降低速度.如果没有索引，MySQL会进行全表扫描，消耗大量IO.</p><h3 id="1-谨慎合理的添加索引"><a href="#1-谨慎合理的添加索引" class="headerlink" title="1 谨慎合理的添加索引"></a>1 谨慎合理的添加索引</h3><p>索引能改善查询的效率，但是也会增加额外的开销并减慢更新的速度(更新时会同时更新索引). 索引的数量不是越多越好，能不加的索引尽量不加. InnoDB的<code>secondary index</code>(非主键索引）使用<code>b+tree</code>来存储，因此在UPDATE、DELETE、INSERT的时候需要对<code>b+tree</code>进行调整，过多的索引会减慢更新的速度.</p><p>按照目前的业务需求，单表的索引应符合下列要求：</p><ul><li>索引数量控制在5个左右，单个索引的字段不超过5个.在设计的时候要结合SQL和需求考虑索引的覆盖.</li><li>唯一键由3个以下字段组成，当字段都是整形时，使用唯一键作为主键.</li><li>唯一键不和主键重复，即不得在主键上建唯一索引.</li><li>较长的字段需加入前缀索引来减少索引长度，提高效率.</li></ul><p>例子如下:</p><pre><code>create table url( address VARCHAR(100) NOT NULL，index idx_url(address(10)));</code></pre><p> 前缀索引长度依据索引的覆盖率来定,建立索引之前最好查看下对应字段建立索引的概率.MySQL5.6优化了合并索引，也就是说一条SQL上可以使用两个索引了.</p><h3 id="2-提高索引的覆盖率"><a href="#2-提高索引的覆盖率" class="headerlink" title="2 提高索引的覆盖率"></a>2 提高索引的覆盖率</h3><p>合理利用覆盖索引.</p><p>关于覆盖索引：<code>InnoDB</code> 存储引擎中，<code>secondary index</code>（非主键索引）中没有直接存储行地址，而存储主键值. 如果用户需要查询<code>secondary index</code>中所不包含的数据列时，需要先通过<code>secondary index</code>查找到主键值，然后再通过主键查询到其他数据列，因此需要查询两次. 覆盖索引的概念就是查询可以通过在一个索引中完成，覆盖索引效率会比较高，主键查询是覆盖索引.</p><p>合理的创建索引以及合理的使用查询语句，当使用到覆盖索引时可以获得性能提升.<br>比如<code>SELECT email,uid FROM user_email WHERE uid=xxx</code>，可以将索引添加为<code>index(uid,email)</code>，以提升性能.</p><p>索引字段的顺序需要考虑字段值去重之后的个数，个数多的放在前面.<br>合理创建联合索引（避免冗余），(a,b,c相当于 (a、(a,b、(a,b,c). 遵循最左原则.<br>UPDATE、DELETE语句需要根据WHERE条件添加索引.</p><h3 id="3-索引使用需要注意的事项"><a href="#3-索引使用需要注意的事项" class="headerlink" title="3 索引使用需要注意的事项"></a>3 索引使用需要注意的事项</h3><ul><li><p>不建议使用<code>%</code>前缀模糊查询，例如<code>LIKE &quot;%xxx&quot;</code>，这样会扫全表.</p></li><li><p>不要在索引列进行数学或者函数计算.</p><pre><code>select * from table where id +1 =10000;</code></pre><p>  这样不会使用索引，导致扫全表，改为:</p><pre><code>select * from table where id =10000-1;</code></pre></li><li><p>使用<code>EXPLAIN</code>判断SQL语句是否合理使用索引，尽量避免<code>extra</code>列出现：<code>Using File Sort</code>，<code>Using Temporary</code>.</p><p>  下面列出<code>extra</code>列常见的值:</p><p>  a. <code>Using Temporary</code></p><p>  为了解决查询，MySQL需要创建一个临时表来容纳结果. 典型情况如查询包含可以按不同情况列出列的<code>GROUP BY</code>和<code>ORDER BY</code>子句. 使用临时表的开销是比较大的.</p><p>  b. <code>Using File Sort</code></p><p>  MySQL需要额外的一次传递，以找出如何按排序顺序检索行. 出现这个说明SQL没有走索引. MySQL通过根据联接类型浏览所有行并为所有匹配WHERE子句的行保存排序关键字和行的指针来完成排序.</p><p>  c. <code>Using index</code></p><p>  从只使用索引树中的信息而不需要进一步搜索读取实际的行来检索表中的列信息.</p><p>  d. <code>Using where</code></p><p>  MySQL使用where条件进行过滤找到匹配行返回客户端.</p></li><li><p>禁止使用外键. 因为会产生额外开销，并且是逐行进行操作. 最关键的是在高并发的情况下很容易造成死锁.</p></li><li><p>SQL变更需要确认索引是否需要变更，并通知DBA.</p></li></ul><h2 id="五-SQL规范"><a href="#五-SQL规范" class="headerlink" title="五. SQL规范"></a>五. SQL规范</h2><h3 id="1-核心思想"><a href="#1-核心思想" class="headerlink" title="1. 核心思想"></a>1. 核心思想</h3><ul><li>使用prepared statement，可以提高性能并且避免SQL注入.</li><li>尽量避免大SQL，因为在高并发的情况下，一个大SQL容易堵死数据库.</li></ul><h3 id="2-注意事项"><a href="#2-注意事项" class="headerlink" title="2. 注意事项"></a>2. 注意事项</h3><p>线上MySQL采用的是5.6版本，所以下列都以5.6版本为例子.</p><h4 id="2-1-使用合理的分页方式以提高分页的效率"><a href="#2-1-使用合理的分页方式以提高分页的效率" class="headerlink" title="2.1 使用合理的分页方式以提高分页的效率."></a>2.1 使用合理的分页方式以提高分页的效率.</h4><p>例子如下：</p><pre><code>SELECT * FROM TABLE ORDER BY IDLIMIT 1000000,10;</code></pre><p>这种分页方式会导致大量的io，因为MySQL使用的是提前读取策略, LIMIT越大效率越低. 另外UPDATE、DELETE语句不使用LIMIT.</p><p>上面sql应改为:</p><pre><code>SELECT * FROM TABLE WHERE ID &gt; LAST_ID ORDER BY ID LIMIT 10 (LAST_ID为具体值)</code></pre><h4 id="2-2-SELECT语句只获取需要的字段"><a href="#2-2-SELECT语句只获取需要的字段" class="headerlink" title="2.2 SELECT语句只获取需要的字段"></a>2.2 SELECT语句只获取需要的字段</h4><p>用select * 时会消耗更多的CPU，内存，IO，当表越大时消耗越大.</p><p>只读取有效的字段，可以提高索引覆盖，而且更安全(可以减少表变化带来的影响),减少网络传输、磁盘io时间。</p><h4 id="2-3-避免负向查询和前缀模糊查询"><a href="#2-3-避免负向查询和前缀模糊查询" class="headerlink" title="2.3 避免负向查询和前缀模糊查询"></a>2.3 避免负向查询和前缀模糊查询</h4><p>前缀模糊查询是不能使用索引. 负向查询是!=,&lt;&gt;, not in ,not exits,not like.是会导致无法使用索引的.</p><h4 id="2-4-WHERE条件中必须使用合适的类型"><a href="#2-4-WHERE条件中必须使用合适的类型" class="headerlink" title="2.4 WHERE条件中必须使用合适的类型"></a>2.4 WHERE条件中必须使用合适的类型</h4><p>WHERE条件中的字符类型与对应字段的字符类型要一致。当类型不匹配时，MySQL会使用隐式转换,此时不会走索引.</p><h4 id="2-5-OR改写为IN"><a href="#2-5-OR改写为IN" class="headerlink" title="2.5 OR改写为IN"></a>2.5 OR改写为IN</h4><p>同一字段将OR改为IN. OR的效率为O(N),IN的效率为O(LOG N).N越大差距越大，当N很大时，OR会慢很多. 另外在使用IN的时候注意控制IN中的N个数.</p><h4 id="2-6-合理的排序"><a href="#2-6-合理的排序" class="headerlink" title="2.6 合理的排序"></a>2.6 合理的排序</h4><p>随机排序不要使用<code>ORDER BY RAND()</code>，使用其他方法替换.</p><pre><code>SELECT * FROM test1 ORDER BY RAND(LIMIT 1)</code></pre><p>该语句EXPLAIN type为<code>ALL</code> EXTRA为 <code>Using File Sort</code>.<br>可以改为:</p><pre><code>SELECT id FROM test1 ORDER BY RAND(LIMIT 1);SELECT * FROM test1 WHERE id=?;</code></pre><p>这2个语句都使用到了索引，性能比较好.</p><h4 id="2-7-HAVING子句"><a href="#2-7-HAVING子句" class="headerlink" title="2.7 HAVING子句"></a>2.7 HAVING子句</h4><p>HAVING在检索出所有记录后才会对结果集进行过滤.如果能通过where子句限制记录数量，那就能减少开销.</p><p>比如将：</p><pre><code>select * from test1 group by id having id &gt;3;</code></pre><p>替换为</p><pre><code>select * from test1 where id &gt;3 group by id;</code></pre><h4 id="2-8-使用合理的SQL语句减少与数据库的交互次数"><a href="#2-8-使用合理的SQL语句减少与数据库的交互次数" class="headerlink" title="2.8 使用合理的SQL语句减少与数据库的交互次数."></a>2.8 使用合理的SQL语句减少与数据库的交互次数.</h4><p>减少与数据库的交互次数的SQL：</p><pre><code>`INSERT IGNORE``INSERT INTO values()`</code></pre><p>改为</p><pre><code>`INSERT … ON DUPLICATE KEY UPDATE`</code></pre><p><code>ON DUPLICATE KEY UPDATE</code> 是一种高效的唯一键或者主键冲突判断. 冲突则执行UPDATE，不冲突则执行INSERT语句.</p><h4 id="2-9-COUNT"><a href="#2-9-COUNT" class="headerlink" title="2.9 COUNT(*)"></a>2.9 COUNT(*)</h4><p>在不加WHRER条件下<code>count(col)</code>跟<code>count(*)</code>差不多，但是在加入了WHERE条件后<code>count(*)</code>的性能比<code>count(col)</code>和<code>count(1)</code>好. MySQL<code>count(*)</code> 对作了特殊处理.</p><h4 id="2-10-or和union"><a href="#2-10-or和union" class="headerlink" title="2.10 or和union"></a>2.10 <code>or</code>和<code>union</code></h4><p>在MySQL5.6中优化了合并索引.一条SQL可以使用2个索引(INDEX_MERGE).但是如果三个字段的索引则使用不上索引合并.3个字段条件查找时候用<code>UNION</code>替代<code>OR</code>，如果不需要去重则用<code>UNION ALL</code>代替<code>OR</code>.(被查找的字段上都有相应的索引)</p><p>例如,下面的例子在数据均匀分布的情况下：</p><pre><code>`SELECT * FROM test1 WHERE id =&apos;3&apos; OR address =&apos;5&apos; or age =10`</code></pre><p>改为</p><pre><code>SELECT * FROM test1 WHERE id =&apos;1&apos;UNION SELECT * FROM test1 WHERE address =&apos;5&apos;UNION SELETE * FROM test1 WHERE age =&apos;10&apos;`</code></pre><p>第一种只执行一步但是无法使用索引会全表扫描.第二种会执行4步，分别查询值然后再union result.虽然步骤多但是查询走索引，union result只是从union临时表获取结果集合. 性能比第一种好一些.</p><h4 id="2-11-触发器，存储过程"><a href="#2-11-触发器，存储过程" class="headerlink" title="2.11 触发器，存储过程"></a>2.11 触发器，存储过程</h4><p>尽量减少触发器，存储过程的使用和MySQL函数对结果集的处理.</p><h4 id="2-12-事务"><a href="#2-12-事务" class="headerlink" title="2.12 事务"></a>2.12 事务</h4><p>事务的原则是即开即用，用完即停.与事务无关的操作放到事务外面，减少锁资源的占用.</p><h2 id="六-数据库基本优化策略"><a href="#六-数据库基本优化策略" class="headerlink" title="六. 数据库基本优化策略"></a>六. 数据库基本优化策略</h2><p>参考 <a href="http://blog.csdn.net/yzsind/article/details/6059209" target="_blank" rel="noopener">面向程序员的数据库访问性能优化法则</a></p><p>数据库优化策略有以下几种方式：</p><ul><li>减少数据访问（减少磁盘访问）</li><li>返回更少数据（减少网络传输或磁盘访问）</li><li>减少交互次数（减少网络传输）</li><li>减少服务器CPU开销（减少CPU及内存开销）</li><li>利用更多资源（增加资源）</li></ul><p>这几种方法的收益如下图：<br><img src="res/perf.gif" alt="image"></p><p><img src="res/io_perf.gif" alt="image"></p><p>下面列出每种优化方式的一些具体方法。</p><h3 id="1-减少数据访问"><a href="#1-减少数据访问" class="headerlink" title="1 减少数据访问"></a>1 减少数据访问</h3><h4 id="1-1-创建并使用正确的索引"><a href="#1-1-创建并使用正确的索引" class="headerlink" title="1.1 创建并使用正确的索引"></a>1.1 创建并使用正确的索引</h4><p>通过合理的创建和使用索引来减少数据访问。</p><h4 id="1-2-尽量通过索引访问数据"><a href="#1-2-尽量通过索引访问数据" class="headerlink" title="1.2 尽量通过索引访问数据"></a>1.2 尽量通过索引访问数据</h4><p>合理利用覆盖索引.</p><h4 id="1-3-优化SQL执行计划"><a href="#1-3-优化SQL执行计划" class="headerlink" title="1.3 优化SQL执行计划"></a>1.3 优化SQL执行计划</h4><p>SQL执行计划是关系型数据库最核心的技术之一，它表示SQL执行时的数据访问算法。通过执行计划可以判断SQL是否合理。</p><h3 id="2-返回更少数据"><a href="#2-返回更少数据" class="headerlink" title="2 返回更少数据"></a>2 返回更少数据</h3><h4 id="2-1-数据分页处理"><a href="#2-1-数据分页处理" class="headerlink" title="2.1 数据分页处理"></a>2.1 数据分页处理</h4><p>通过分页的处理，减少数据的返回量。还有通过分表控制表的大小，增加查询的效率。</p><h4 id="2-2-只返回需要的字段"><a href="#2-2-只返回需要的字段" class="headerlink" title="2.2 只返回需要的字段"></a>2.2 只返回需要的字段</h4><p>通过去除不必要的返回字段可以提高性能。</p><h3 id="3-减少交互次数"><a href="#3-减少交互次数" class="headerlink" title="3 减少交互次数"></a>3 减少交互次数</h3><h4 id="3-1-批量提交"><a href="#3-1-批量提交" class="headerlink" title="3.1 批量提交"></a>3.1 批量提交</h4><p>通过批量提交的方式来减少交互次数，如当你要往一个表中插入1000万条数据时，如果采用普通的executeUpdate处理，那么和服务器交互次数为1000万次，按每秒钟可以向数据库服务器提交10000次估算，要完成所有工作需要1000秒。如果采用批量提交模式，1000条提交一次，那么和服务器交互次数为1万次，交互次数大大减少。</p><h4 id="3-2-合并查询语句"><a href="#3-2-合并查询语句" class="headerlink" title="3.2 合并查询语句"></a>3.2 合并查询语句</h4><pre><code>for :var in ids[] do begin      select * from mytable where id=:var;end;</code></pre><p>我们也可以做一个小的优化， 如下所示，用ID INLIST的这种方式写SQL：</p><pre><code>select * from mytable where id in(:id1,id2,...,idn);</code></pre><h4 id="3-3-设置Fetch-Size"><a href="#3-3-设置Fetch-Size" class="headerlink" title="3.3 设置Fetch Size"></a>3.3 设置Fetch Size</h4><p>当我们采用select从数据库查询数据时，数据默认并不是一条一条返回给客户端的，也不是一次全部返回客户端的，而是根据客户端<code>fetch_size</code>参数处理，每次只返回<code>fetch_size</code>条记录，当客户端游标遍历到尾部时再从服务端取数据，直到最后全部传送完成。所以如果我们要从服务端一次取大量数据时，可以加大<code>fetch_size</code>，这样可以减少结果数据传输的交互次数及服务器数据准备时间，提高性能。</p><h3 id="4-减少CPU开销"><a href="#4-减少CPU开销" class="headerlink" title="4 减少CPU开销"></a>4 减少CPU开销</h3><h4 id="4-1-使用绑定变量"><a href="#4-1-使用绑定变量" class="headerlink" title="4.1 使用绑定变量"></a>4.1 使用绑定变量</h4><p>绑定变量是指SQL中对变化的值采用变量参数的形式提交，而不是在SQL中直接拼写对应的值。这样可以防止SQL注入并且提高SQL解析性能(硬解析变为软解析).</p><h4 id="4-2-大量复杂运算在客户端处理"><a href="#4-2-大量复杂运算在客户端处理" class="headerlink" title="4.2 大量复杂运算在客户端处理"></a>4.2 大量复杂运算在客户端处理</h4><p>一些复杂的运算，不要用数据库来处理.如含小数的对数及指数运算和加密处理等.</p><h4 id="4-3-减少特殊比较操作和合理使用排序"><a href="#4-3-减少特殊比较操作和合理使用排序" class="headerlink" title="4.3 减少特殊比较操作和合理使用排序"></a>4.3 减少特殊比较操作和合理使用排序</h4><p>我们SQL的业务逻辑经常会包含一些比较操作，如<code>a=b</code>，<code>a&lt;b</code>之类的操作，对于这些比较操作数据库都体现得很好，但是对一些特殊的比较操作，我们需要保持警惕. （如：like和IN（1,2,….n）n值过多），另外在使用SQL的确定是否需要排序，大量数据排序会增加CPU的开销。详细例子在后面章节列出。</p><hr>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;一-数据库核心规范&quot;&gt;&lt;a href=&quot;#一-数据库核心规范&quot; class=&quot;headerlink&quot; title=&quot;一. 数据库核心规范&quot;&gt;&lt;/a&gt;一. 数据库核心规范&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;尽量不要在数据库做运算：cpu计算请移至业务层.&lt;/li&gt;
&lt;li&gt;
      
    
    </summary>
    
    
      <category term="MySQL" scheme="http://btbib.com/categories/MySQL/"/>
    
    
      <category term="MySQL" scheme="http://btbib.com/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>start.aliyun.com 正式上线！极速构建 Spring Cloud 应用</title>
    <link href="http://btbib.com/2020-03-25-2.html"/>
    <id>http://btbib.com/2020-03-25-2.html</id>
    <published>2020-03-25T01:33:38.000Z</published>
    <updated>2020-03-28T07:55:02.000Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://start.aliyun.com" target="_blank" rel="noopener"><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL3N6X21tYml6X3BuZy9xZHpaQkU3M2hXdHBscGRiS1k2aWFJeHhkd29lVkUwclVYa0Q1T0poT0hrS0FJZVgySnFWM3A4eVI3VGJKaWNSaWFBU0kwSGt5WDlQZG1RN1VzWkRRV0JnQS82NDA?x-oss-process=image/format,png" alt="" title="markdown"></a><br>Photo @ Alibaba Initializr 官网</p><p>浏览器访问 ： <a href="https://start.aliyun.com" target="_blank" rel="noopener">https://start.aliyun.com</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;a href=&quot;https://start.aliyun.com&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;&lt;img src=&quot;https://imgconvert.csdnimg.cn/aHR0cHM6Ly9tbWJpei5xcGljLmNuL3N
      
    
    </summary>
    
    
      <category term="阿里巴巴中间件" scheme="http://btbib.com/categories/%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4%E4%B8%AD%E9%97%B4%E4%BB%B6/"/>
    
    
      <category term="Java后端" scheme="http://btbib.com/tags/Java%E5%90%8E%E7%AB%AF/"/>
    
      <category term="Spring Cloud" scheme="http://btbib.com/tags/Spring-Cloud/"/>
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="http://btbib.com/2020-03-15-1.html"/>
    <id>http://btbib.com/2020-03-15-1.html</id>
    <published>2020-03-15T08:22:20.000Z</published>
    <updated>2020-03-28T07:54:48.000Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="noopener">Deployment</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Welcome to &lt;a href=&quot;https://hexo.io/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;https://hexo.
      
    
    </summary>
    
    
      <category term="hexo" scheme="http://btbib.com/categories/hexo/"/>
    
    
  </entry>
  
</feed>
